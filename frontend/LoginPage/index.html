<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Login to Roommate Match</title>
        <!-- Use url_for so the correct static path is injected -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='LoginPage/styles.css') }}"
        />
    </head>
    <body>
        <h1 id="top-header" class="bordered-content">
            Login to My Roommate Match
        </h1>

        <div class="login-container">
            <div id="login-bar" class="login-input">
                <h2>Login</h2>

                <div>
                    <input
                        type="text"
                        id="user-name"
                        class="user-name"
                        placeholder="Enter your name"
                    />
                </div>
                <br />

                <div>
                    <input
                        type="text"
                        id="user-classYear"
                        class="user-classYear"
                        placeholder="Class year"
                    />
                </div>
                <br />

                <div>
                    <input
                        type="text"
                        id="user-email"
                        class="user-email"
                        placeholder="Swarthmore Email..."
                    />
                </div>
                <br />

                <div>
                    <input
                        type="password"
                        id="user-password"
                        class="user-password"
                        placeholder="Password"
                    />
                </div>
                <br />

                <div>
                    <button class="submit-button" onclick="buttonClicked()">
                        Submit
                    </button>
                </div>
            </div>
        </div>

        <script>
            /*
             * buttonClicked(): gather form fields and send a POST request
             * to the Flask /login endpoint. On success, redirect to the
             * questionnaire page and stash user info in localStorage.
             */
            function buttonClicked() {
                const userName = document
                    .getElementById("user-name")
                    .value.trim();
                const userPassword =
                    document.getElementById("user-password").value;

                if (!userName || !userPassword) {
                    alert("Please enter both username and password.");
                    return;
                }

                fetch("/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        username: userName,
                        password: userPassword,
                    }),
                })
                    .then(async (response) => {
                        const data = await response.json();
                        if (response.ok) {
                            alert("Login successful!");

                            // Save user for later API calls
                            localStorage.setItem(
                                "user",
                                JSON.stringify(data.user),
                            );

                            // Go straight to the questionnaire
                            window.location.href =
                                "{{ url_for('static', filename='UserInterface/questionnaire.html') }}";
                        } else {
                            alert(data.error || "Login failed");
                        }
                    })
                    .catch((err) => {
                        console.error(err);
                        alert("Network error â€“ see console for details.");
                    });
            }
        </script>
    </body>
</html>
